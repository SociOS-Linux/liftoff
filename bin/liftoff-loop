#!/bin/bash
set -e

# Load configuration
config="/usr/lib/liftoff/liftoff.conf"
source $config

pbuilderrc="/usr/lib/liftoff/pbuilderrc"


setup_log_output() {
	echo "Setting up log output..."
	mkdir -p "$log_dir"
	timestamp=$(date +%Y-%m-%d-%H.%M.%S)
	log_file="$log_dir/$timestamp-$target_codename-$target_arch.log"
}

add_repo_keys() {
	apt-key adv \
		--keyserver keyserver.ubuntu.com \
		--recv-keys "${keylist[@]}"
}

add_repo_keys

# Start loop
for arch in $(echo $target_archs) ;
    do for dist in $(echo $target_distros) ;
        do setup_log_output && liftoff -a "${arch}" -c "$config" -d "${dist}" -l "$log_file" -p "$pbuilderrc" ;
        done ;
    done
